package com.seaker.seaker.core;

import com.seaker.seaker.vk.CitiesEnum;
import com.seaker.seaker.vk.parser.LeftsFromFriendsParser;
import com.seaker.seaker.vk.parser.LeftsInCityParser;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Controller;

import java.io.IOException;
import java.io.UnsupportedEncodingException;

@Controller
public class ApplicationController {


    private final LeftsInCityParser leftsInCityParser;
    private final LeftsFromFriendsParser friendsParser;

    @Autowired
    public ApplicationController(LeftsInCityParser leftsInCityParser, LeftsFromFriendsParser friendsParser) {
        this.leftsInCityParser = leftsInCityParser;
        this.friendsParser = friendsParser;
    }

    @EventListener({ContextRefreshedEvent.class})
    public void contextRefreshedEvent() throws Exception {
        leftsInCityParser.collectForCity(CitiesEnum.BOLSHOI_KAMEN, 18, 45);
//        friendsParser.collectAllLeftsFromGivenLeftIds(CitiesEnum.BOLSHOI_KAMEN, "375438305, 344818907, 444315203, 465981266, 407199850, 543286481, 552041570, 365274412, 499766038, 503042827, 234979456, 479956767, 284139821, 257714798, 316763403, 326906673, 395713164, 303773305, 350994884, 171699895, 582923861, 306064690, 316163717, 248778524, 454430015, 247638864, 515587083, 242010340, 358184476, 272186640, 107697441, 171805993, 166754208, 177157282, 227963277, 419426637, 285768284, 181817305, 213534655, 54669001, 243656851, 476810083, 446872229, 443906177, 236838824, 192328511, 187050045, 77769462, 168106730, 324580310, 137296360, 182872376, 90108793, 218701670, 257718134, 273213617, 168311315, 163521498, 18434091, 300662289, 143940565, 372376180, 41475816, 156379479, 74578100, 49621711, 186156648, 12747227, 421374184, 165606365, 402561861, 210198554, 587680741, 177232935, 98112068, 176910574, 441364952, 287769655, 155366428, 138466543, 289891963, 504323019, 76045106, 33876213, 551071490, 542944367, 510241721, 146526009, 33381475, 332916159, 472237932, 175040045, 82365632, 532531699, 207311691, 451234467, 330393568, 513031903, 303683677, 286975896, 298273777, 584888378, 198035463, 451818548, 462783916, 182318981, 247933571, 240211176, 174913396, 135555795, 452807777, 31550513, 196582909, 179530296, 343365334, 173048822, 171781123, 635230104, 250894138, 13349800, 55393932, 160559009, 146970793, 142959700, 308535344, 133021449, 278309839, 132095175, 9214944, 161153316, 233026731, 181332571, 427624521, 164062117, 226926102, 168389028, 56272362, 83499680, 344501772");

    }
}
